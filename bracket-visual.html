<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Cuadro Principal</title>

<style>
  body {
    background: #031926;
    color: white;
    margin: 0;
    font-family: system-ui, sans-serif;
  }

  .top-buttons {
    display: flex;
    justify-content: space-between;
    padding: 15px;
  }

  .top-btn {
    background: #ffe36a;
    color: #000;
    padding: 10px 16px;
    border-radius: 12px;
    text-decoration: none;
    font-weight: bold;
  }

  h1 {
    text-align: center;
    margin: 5px 0;
  }

  .tabs {
    display: flex;
    justify-content: center;
    gap: 12px;
    margin-bottom: 10px;
  }

  .tab {
    background: #07354b;
    padding: 10px 18px;
    border-radius: 12px;
    cursor: pointer;
    font-weight: bold;
  }

  .tab.active {
    background: #ffe36a;
    color: #000;
  }

  /* BRACKET AREA */
  .bracket-area {
    position: relative;
    width: 2600px; 
    height: 1400px;
    margin: 0 auto;
    overflow-x: auto;
    padding-bottom: 40px;
  }

  .match {
    position: absolute;
    width: 210px;
    background: white;
    color: black;
    padding: 6px 10px;
    border-radius: 10px;
    border: 2px solid #ddd;
  }

  .match-num {
    background: #ffe36a;
    color: black;
    font-weight: bold;
    padding: 2px 6px;
    border-radius: 6px;
    font-size: 12px;
    margin-bottom: 4px;
  }

  .team {
    padding: 2px 0;
    display: flex;
    justify-content: space-between;
  }

  .winner {
    color: green;
    font-weight: bold;
  }
</style>

</head>

<body>

<!-- NAV -->
<div class="top-buttons">
  <a href="index.html" class="top-btn">Inicio</a>
  <a href="fixture.html" class="top-btn">Fixture</a>
</div>

<h1>Cuadro Principal</h1>

<!-- TABS -->
<div class="tabs">
  <div class="tab active" data-rama="F">Femenino</div>
  <div class="tab" data-rama="M">Masculino</div>
</div>

<!-- BRACKET -->
<div id="bracketArea" class="bracket-area"></div>


<script type="module">

/* --------------------------------------------------------------
   FIREBASE
----------------------------------------------------------------*/
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
import {
  getFirestore, collection, query, where,
  onSnapshot
} from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCDLMrgeu3pNs-hOM1vf006wMzWPqfQ_lQ",
  authDomain: "torneo-beach.firebaseapp.com",
  projectId: "torneo-beach",
  storageBucket: "torneo-beach.firebasestorage.app",
  messagingSenderId: "21136645638",
  appId: "1:21136645638:web:52c3b06affc2ee151eed87"
};

const app = initializeApp(firebaseConfig);
const db  = getFirestore(app);

const bracketArea = document.getElementById("bracketArea");


/* --------------------------------------------------------------
   POSICIONES EXACTAS DEL CUADRO FEMENINO
----------------------------------------------------------------*/

function renderLayoutFemenino() {
  bracketArea.innerHTML = `
    <!-- PRIMERA RONDA -->
    <div class="match" id="m1"  style="top:20px; left:60px"></div>
    <div class="match" id="m2"  style="top:90px; left:60px"></div>

    <div class="match" id="m3"  style="top:200px; left:60px"></div>
    <div class="match" id="m4"  style="top:270px; left:60px"></div>

    <div class="match" id="m5"  style="top:380px; left:60px"></div>
    <div class="match" id="m6"  style="top:450px; left:60px"></div>

    <div class="match" id="m7"  style="top:560px; left:60px"></div>
    <div class="match" id="m8"  style="top:630px; left:60px"></div>

    <!-- SEGUNDA RONDA (G1 vs G2, etc.) -->
    <div class="match" id="m9"  style="top:55px; left:350px"></div>
    <div class="match" id="m10" style="top:235px; left:350px"></div>
    <div class="match" id="m11" style="top:415px; left:350px"></div>
    <div class="match" id="m12" style="top:595px; left:350px"></div>

    <!-- PASE A SEMI -->
    <div class="match" id="m21" style="top:145px; left:650px"></div>
    <div class="match" id="m22" style="top:505px; left:650px"></div>

    <!-- SEMIFINALES / FINAL / TERCER PUESTO -->
    <div class="match" id="m27" style="top:225px; left:950px"></div>
    <div class="match" id="m28" style="top:425px; left:950px"></div>

    <div class="match" id="m30" style="top:325px; left:1200px; width:240px;"></div>
    <div class="match" id="m29" style="top:425px; left:1200px; width:240px;"></div>

    <!-- PERDEDORES 1 -->
    <div class="match" id="m13" style="top:20px; left:1500px"></div>
    <div class="match" id="m14" style="top:100px; left:1500px"></div>
    <div class="match" id="m15" style="top:200px; left:1500px"></div>
    <div class="match" id="m16" style="top:280px; left:1500px"></div>

    <!-- PERDEDORES 2 -->
    <div class="match" id="m17" style="top:60px; left:1750px"></div>
    <div class="match" id="m18" style="top:220px; left:1750px"></div>
    <div class="match" id="m19" style="top:360px; left:1750px"></div>
    <div class="match" id="m20" style="top:500px; left:1750px"></div>

    <!-- PERDEDORES 3 -->
    <div class="match" id="m23" style="top:140px; left:2000px"></div>
    <div class="match" id="m24" style="top:300px; left:2000px"></div>

    <!-- PASE A SEMI (LOSERS) -->
    <div class="match" id="m25" style="top:200px; left:2250px"></div>
    <div class="match" id="m26" style="top:360px; left:2250px"></div>
  `;
}


/* --------------------------------------------------------------
   RENDER DE PARTIDO
----------------------------------------------------------------*/

function renderMatchBox(box, m) {
  box.innerHTML = `
    <div class="match-num">${m.drawMatchNumber}</div>

    <div class="team ${m.winnerTeamId === m.team1Id ? 'winner' : ''}">
      ${m.team1Name || '---'}
    </div>

    <div class="team ${m.winnerTeamId === m.team2Id ? 'winner' : ''}">
      ${m.team2Name || '---'}
    </div>
  `;
}


/* --------------------------------------------------------------
   CARGAR UNA RAMA
----------------------------------------------------------------*/
let unsubscribe = null;

function loadBracket(rama) {

  if (unsubscribe) unsubscribe();

  if (rama === "F") renderLayoutFemenino();
  else bracketArea.innerHTML = "<h2>Cuadro Masculino prontoâ€¦</h2>";

  const q = query(
    collection(db, "matches"),
    where("phase", "==", "maindraw"),
    where("rama", "==", rama)
  );

  unsubscribe = onSnapshot(q, snap => {
    snap.forEach(doc => {
      const m = doc.data();
      const box = document.getElementById("m" + m.drawMatchNumber);
      if (box) renderMatchBox(box, m);
    });
  });

}


/* --------------------------------------------------------------
   TABS
----------------------------------------------------------------*/
document.querySelectorAll(".tab").forEach(t => {
  t.addEventListener("click", () => {
    document.querySelectorAll(".tab").forEach(x => x.classList.remove("active"));
    t.classList.add("active");
    loadBracket(t.dataset.rama);
  });
});


/* Inicial: FEMENINO */
loadBracket("F");

</script>

</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Cuadro Principal</title>

<style>
  body {
    background: #031926;
    color: white;
    margin: 0;
    font-family: system-ui, sans-serif;
  }

  .top-buttons {
    display: flex;
    justify-content: space-between;
    padding: 15px;
  }

  .top-btn {
    background: #ffe36a;
    color: #000;
    padding: 10px 16px;
    border-radius: 12px;
    text-decoration: none;
    font-weight: bold;
  }

  h1 {
    text-align: center;
    margin: 5px 0;
  }

  .tabs {
    display: flex;
    justify-content: center;
    gap: 12px;
    margin-bottom: 10px;
  }

  .tab {
    background: #07354b;
    padding: 10px 18px;
    border-radius: 12px;
    cursor: pointer;
    font-weight: bold;
  }

  .tab.active {
    background: #ffe36a;
    color: #000;
  }

  /* Área del bracket */
  .bracket-area {
    position: relative;
    width: 2600px;
    height: 950px;
    margin: 0 auto;
    overflow-x: auto;
    padding: 20px 0 40px;
  }

  .match {
    position: absolute;
    width: 210px;
    background: white;
    color: black;
    padding: 6px 10px;
    border-radius: 10px;
    border: 2px solid #ddd;
  }

  .match-num {
    background: #ffe36a;
    color: black;
    font-weight: bold;
    padding: 2px 6px;
    border-radius: 6px;
    font-size: 12px;
    margin-bottom: 4px;
  }

  .team {
    padding: 2px 0;
    display: flex;
    justify-content: space-between;
  }

  .winner {
    color: green;
    font-weight: bold;
  }

  .column-label {
    position: absolute;
    color: #ffe36a;
    font-weight: bold;
    text-align: center;
    width: 220px;
  }

  .credit {
    margin: 24px 0 16px;
    text-align: center;
    font-size: 12px;
    opacity: 0.75;
  }

  .credit a {
    color: inherit;
    font-weight: 600;
    text-decoration: none;
  }

  .credit a:hover {
    text-decoration: underline;
  }
</style>
</head>

<body>

<!-- NAV -->
<div class="top-buttons">
  <a href="index.html" class="top-btn">Inicio</a>
  <a href="fixture.html" class="top-btn">Fixture</a>
</div>

<h1>Cuadro Principal</h1>

<!-- TABS -->
<div class="tabs">
  <div class="tab active" data-rama="F">Femenino</div>
  <div class="tab" data-rama="M">Masculino</div>
</div>

<!-- BRACKET -->
<div id="bracketArea" class="bracket-area"></div>

<footer class="credit">
  Sistema Torneo Beach Volley · MacaErlan® 2026 ·
  <a href="https://wa.me/541168319095" target="_blank" rel="noopener">WhatsApp +54 11 6831-9095</a>
</footer>

<script type="module">
/* --------------------------------------------------------------
   FIREBASE
----------------------------------------------------------------*/
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
import {
  getFirestore, collection, query, where,
  onSnapshot
} from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCDLMrgeu3pNs-hOM1vf006wMzWPqfQ_lQ",
  authDomain: "torneo-beach.firebaseapp.com",
  projectId: "torneo-beach",
  storageBucket: "torneo-beach.firebasestorage.app",
  messagingSenderId: "21136645638",
  appId: "1:21136645638:web:52c3b06affc2ee151eed87"
};

const app = initializeApp(firebaseConfig);
const db  = getFirestore(app);

const bracketArea = document.getElementById("bracketArea");

/* --------------------------------------------------------------
   LAYOUT GANADORES/PERDEDORES – coordenadas fijas
----------------------------------------------------------------*/
const bracketLayoutHTMLFemenino = `
  <!-- GANADORES – IZQUIERDA -->

  <!-- Etiquetas de columnas ganadores -->
  <div class="column-label" style="top:0px; left:60px">Ronda 1</div>
  <div class="column-label" style="top:0px; left:350px">Ronda 2</div>
  <div class="column-label" style="top:0px; left:650px">Cuartos</div>

  <!-- 1ra RONDA (1–8) -->
  <div class="match" id="m1"  style="top:20px;  left:60px"></div>
  <div class="match" id="m2"  style="top:100px; left:60px"></div>

  <div class="match" id="m3"  style="top:230px; left:60px"></div>
  <div class="match" id="m4"  style="top:310px; left:60px"></div>

  <div class="match" id="m5"  style="top:440px; left:60px"></div>
  <div class="match" id="m6"  style="top:520px; left:60px"></div>

  <div class="match" id="m7"  style="top:650px; left:60px"></div>
  <div class="match" id="m8"  style="top:730px; left:60px"></div>

  <!-- 2da RONDA (9–12) centrados entre sus pares -->
  <div class="match" id="m9"  style="top:60px;  left:350px"></div>
  <div class="match" id="m10" style="top:270px; left:350px"></div>
  <div class="match" id="m11" style="top:480px; left:350px"></div>
  <div class="match" id="m12" style="top:690px; left:350px"></div>

  <!-- PASE A SEMI GANADORES (21,22) -->
  <!-- 21 alineado con 27 y 25 -->
  <div class="match" id="m21" style="top:260px; left:650px"></div>
  <!-- 22 alineado con 28 y 26 -->
  <div class="match" id="m22" style="top:600px; left:650px"></div>

  <!-- SEMIS (27, 28) + FINAL (30) + 3P (29) – centro -->
  <!-- 27 alineado con 21–25 -->
  <div class="match" id="m27" style="top:260px; left:950px"></div>
  <!-- 28 alineado con 22–26 -->
  <div class="match" id="m28" style="top:600px; left:950px"></div>

  <!-- Final arriba de 27 (misma columna que 27/28) -->
  <div class="match" id="m30" style="top:150px; left:950px; width:240px;"></div>
  <!-- 3° puesto abajo de 28 (misma columna que 27/28) -->
  <div class="match" id="m29" style="top:710px; left:950px; width:240px;"></div>

  <!-- PERDEDORES – DERECHA → IZQUIERDA -->

  <!-- Etiquetas de columnas perdedores -->
  <div class="column-label" style="top:0px; left:2060px">Perdedores R1</div>
  <div class="column-label" style="top:0px; left:1790px">Perdedores R2</div>
  <div class="column-label" style="top:0px; left:1520px">Perdedores R3</div>
  <div class="column-label" style="top:0px; left:1250px">Perdedores pase a semi</div>

  <!-- 1ra RONDA PERD. (13–16) – más a la derecha -->
  <div class="match" id="m13" style="top:60px;  left:2060px"></div>
  <div class="match" id="m14" style="top:230px; left:2060px"></div>
  <div class="match" id="m15" style="top:460px; left:2060px"></div>
  <div class="match" id="m16" style="top:630px; left:2060px"></div>

  <!-- 2da RONDA PERD. (17–20) – un paso hacia el centro -->
  <div class="match" id="m17" style="top:110px; left:1790px"></div>
  <div class="match" id="m18" style="top:280px; left:1790px"></div>
  <div class="match" id="m19" style="top:510px; left:1790px"></div>
  <div class="match" id="m20" style="top:680px; left:1790px"></div>

  <!-- 3ra RONDA PERD. (23–24) – más cerca del centro -->
  <div class="match" id="m23" style="top:200px; left:1520px"></div>
  <div class="match" id="m24" style="top:600px; left:1520px"></div>

  <!-- PASE A SEMI PERD. (25–26) – casi centro, rumbo a 27/28 -->
  <!-- 25 alineado con 21 y 27 -->
  <div class="match" id="m25" style="top:260px; left:1250px"></div>
  <!-- 26 alineado con 22 y 28 -->
  <div class="match" id="m26" style="top:600px; left:1250px"></div>
`;

const bracketLayoutHTMLMasculino = `
  <!-- GANADORES – 16 llaves con cruce mostrado en la imagen -->

  <!-- Etiquetas -->
  <div class="column-label" style="top:0px; left:60px">Ronda 1</div>
  <div class="column-label" style="top:0px; left:330px">Ronda 2</div>
  <div class="column-label" style="top:0px; left:600px">Cuartos</div>
  <div class="column-label" style="top:0px; left:870px">Semis</div>
  <div class="column-label" style="top:0px; left:1140px">Final</div>

  <!-- RONDA 1 (1–16) -->
  <div class="match" id="m1"  style="top:20px;  left:60px"></div>
  <div class="match" id="m2"  style="top:90px;  left:60px"></div>

  <div class="match" id="m3"  style="top:200px; left:60px"></div>
  <div class="match" id="m4"  style="top:270px; left:60px"></div>

  <div class="match" id="m5"  style="top:420px; left:60px"></div>
  <div class="match" id="m6"  style="top:490px; left:60px"></div>

  <div class="match" id="m7"  style="top:640px; left:60px"></div>
  <div class="match" id="m8"  style="top:710px; left:60px"></div>

  <div class="match" id="m9"  style="top:860px; left:60px"></div>
  <div class="match" id="m10" style="top:930px; left:60px"></div>

  <div class="match" id="m11" style="top:1080px; left:60px"></div>
  <div class="match" id="m12" style="top:1150px; left:60px"></div>

  <div class="match" id="m13" style="top:1300px; left:60px"></div>
  <div class="match" id="m14" style="top:1370px; left:60px"></div>

  <div class="match" id="m15" style="top:1520px; left:60px"></div>
  <div class="match" id="m16" style="top:1590px; left:60px"></div>

  <!-- RONDA 2 (17–24) -->
  <div class="match" id="m17" style="top:55px;  left:330px"></div>
  <div class="match" id="m18" style="top:235px; left:330px"></div>
  <div class="match" id="m19" style="top:455px; left:330px"></div>
  <div class="match" id="m20" style="top:675px; left:330px"></div>
  <div class="match" id="m21" style="top:895px; left:330px"></div>
  <div class="match" id="m22" style="top:1115px; left:330px"></div>
  <div class="match" id="m23" style="top:1335px; left:330px"></div>
  <div class="match" id="m24" style="top:1555px; left:330px"></div>

  <!-- CUARTOS (25–28) -->
  <div class="match" id="m25" style="top:145px; left:600px"></div>
  <div class="match" id="m26" style="top:565px; left:600px"></div>
  <div class="match" id="m27" style="top:1005px; left:600px"></div>
  <div class="match" id="m28" style="top:1445px; left:600px"></div>

  <!-- SEMIS (29–30) -->
  <div class="match" id="m29" style="top:355px; left:870px"></div>
  <div class="match" id="m30" style="top:1225px; left:870px"></div>

  <!-- FINAL (31) -->
  <div class="match" id="m31" style="top:790px; left:1140px; width:240px;"></div>
`;

function renderLayoutFemenino() {
  bracketArea.style.width = "2600px";
  bracketArea.style.height = "950px";
  bracketArea.innerHTML = bracketLayoutHTMLFemenino;
}

function renderLayoutMasculino() {
  bracketArea.style.width = "1500px";
  bracketArea.style.height = "1750px";
  bracketArea.innerHTML = bracketLayoutHTMLMasculino;
}

/* --------------------------------------------------------------
   Render de un partido dentro de su caja
----------------------------------------------------------------*/
function renderMatchBox(box, m) {
  const specialLabel = {
    27: 'Semi 1',
    28: 'Semi 2',
    29: '3er Puesto',
    30: 'Final',
    31: 'Final'
  }[m.drawMatchNumber] || '';

  box.innerHTML = `
    <div class="match-num">${m.drawMatchNumber}${specialLabel ? ' ' + specialLabel : ''}</div>
    <div class="team ${m.winnerTeamId === m.team1Id ? 'winner' : ''}">
      ${m.team1Name || '---'}
    </div>
    <div class="team ${m.winnerTeamId === m.team2Id ? 'winner' : ''}">
      ${m.team2Name || '---'}
    </div>
  `;
}

/* --------------------------------------------------------------
   Cargar bracket por rama (usa onSnapshot)
----------------------------------------------------------------*/
let unsubscribe = null;

function loadBracket(rama) {
  if (unsubscribe) unsubscribe?.();

  if (rama === "F") {
    renderLayoutFemenino();
  } else {
    renderLayoutMasculino();
  }

  const q = query(
    collection(db, "matches"),
    where("phase", "==", "maindraw"),
    where("rama", "==", rama)
  );

  unsubscribe = onSnapshot(q, snap => {
    snap.forEach(doc => {
      const m = doc.data();
      const box = document.getElementById("m" + m.drawMatchNumber);
      if (box) renderMatchBox(box, m);
    });
  });
}

/* --------------------------------------------------------------
   Tabs
----------------------------------------------------------------*/
document.querySelectorAll(".tab").forEach(tab => {
  tab.addEventListener("click", () => {
    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    tab.classList.add("active");
    loadBracket(tab.dataset.rama);
  });
});

/* Inicial: FEM */
loadBracket("F");
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cuadro Principal - Torneo</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f2f2f2;
      margin: 0;
      padding: 0;
    }

    header {
      background: #333;
      color: white;
      text-align: center;
      padding: 10px;
      font-size: 22px;
    }

    .selector {
      background: white;
      padding: 10px;
      border-bottom: 1px solid #ccc;
      display: flex;
      justify-content: center;
      gap: 10px;
    }

    .round-block {
      margin: 20px;
      background: white;
      padding: 10px 15px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,.15);
    }

    .round-title {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 12px;
    }

    .match {
      background: #fafafa;
      border: 1px solid #ddd;
      padding: 10px;
      margin-bottom: 8px;
      border-radius: 8px;
    }

    .match p {
      margin: 4px 0;
    }
  </style>
</head>
<body>

<header>
  Cuadro Principal
</header>

<div class="selector">
  <select id="ramaSelector">
    <option value="F">Femenino</option>
    <option value="M">Masculino</option>
  </select>
</div>

<div id="cuadroContainer"></div>



<!-- FIREBASE + L√ìGICA DEL CUADRO -->
<script type="module">

  // ============================
  // Firebase INIT
  // ============================
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
  import { 
    getFirestore, 
    collection, 
    query, 
    where, 
    getDocs 
  } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCDLMrgeu3pNs-hOM1vf006wMzWPqfQ_lQ",
    authDomain: "torneo-beach.firebaseapp.com",
    projectId: "torneo-beach",
    storageBucket: "torneo-beach.firebasestorage.app",
    messagingSenderId: "21136645638",
    appId: "1:21136645638:web:52c3b06affc2ee151eed87"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);



  // ============================
  // ELEMENTOS DEL DOM
  // ============================
  const cuadroContainer = document.getElementById("cuadroContainer");
  const ramaSelector    = document.getElementById("ramaSelector");


  ramaSelector.addEventListener("change", loadCuadro);
  window.addEventListener("DOMContentLoaded", loadCuadro);



  // ============================
  // CARGAR CUADRO DESDE FIRESTORE
  // ============================
  async function loadCuadro() {

    const rama = ramaSelector.value;

    cuadroContainer.innerHTML = `
      <p style="padding:20px; text-align:center;">Cargando cuadro...</p>
    `;

    // Traer solo partidos del MAIN DRAW
    const q = query(
      collection(db, "matches"),
      where("phase", "==", "maindraw"),
      where("rama", "==", rama)
    );

    const snap = await getDocs(q);

    if (snap.empty) {
      cuadroContainer.innerHTML = `
        <p style="padding:20px; text-align:center;">
          üü° Todav√≠a no se gener√≥ el cuadro principal para <b>${rama === "F" ? "Femenino" : "Masculino"}</b>.
        </p>`;
      return;
    }

    // Convertir docs a array ordenado
    const matches = snap.docs.map(d => d.data());

    // Agrupar por roundLabel
    const porRonda = {};
    for (const m of matches) {
      if (!porRonda[m.roundLabel]) porRonda[m.roundLabel] = [];
      porRonda[m.roundLabel].push(m);
    }

    // Ordenar cada ronda por drawMatchNumber
    for (const r in porRonda) {
      porRonda[r].sort((a, b) => a.drawMatchNumber - b.drawMatchNumber);
    }

    cuadroContainer.innerHTML = "";

    // Renderizar rondas
    for (const [ronda, lista] of Object.entries(porRonda)) {

      const block = document.createElement("div");
      block.className = "round-block";

      block.innerHTML += `<div class="round-title">${ronda}</div>`;

      lista.forEach(m => {
        block.innerHTML += `
          <div class="match">
            <p><b>Partido #${m.drawMatchNumber}</b></p>
            <p>${m.team1Name || "----"} vs ${m.team2Name || "----"}</p>
            ${m.status === "finished" ? `<p><b>Gan√≥:</b> ${m.winnerTeamName}</p>` : ""}
          </div>
        `;
      });

      cuadroContainer.appendChild(block);
    }
  }

</script>

</body>
</html>
